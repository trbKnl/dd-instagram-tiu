import*as e from"react";import t,{useMemo as n,forwardRef as a,useState as r,useCallback as o,createContext as l,useContext as i,useRef as c,useEffect as s}from"react";import d from"lodash";var u=function(){return u=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},u.apply(this,arguments)};function m(e,t,n,a){return new(n||(n=Promise))((function(r,o){function l(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}c((a=a.apply(e,t||[])).next())}))}function f(e,t){var n,a,r,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=i(0),l.throw=i(1),l.return=i(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,i[0]&&(o=0)),o;)try{if(n=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function p(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var g=function(){function e(e){this.factory=e}return e.prototype.start=function(e,t,n){console.log("[ReactEngine] started"),this.locale=t,this.setState=n},e.prototype.render=function(e){return m(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return console.debug("[ReactEngine] render",e),[4,this.renderPage(e.page)];case 1:return t=n.sent(),console.log("[ReactEngine] render done",e,t),[2,{__type__:"Response",command:e,payload:t}]}}))}))},e.prototype.renderPage=function(e){var t=this;return new Promise((function(n){var a={locale:t.locale,resolve:n},r=t.factory.createPage(e,a);t.updateElements([r])}))},e.prototype.updateElements=function(e){if(this.setState){var n=e.map((function(e,n){return t.cloneElement(e,{key:"feldspar-element-".concat(n)})}));this.setState({elements:n})}},e.prototype.terminate=function(){this.setState=void 0},e}(),v=function(e,t,n){return(null==e?void 0:e.__type__)===t&&h(e,n)},h=function(e,t){return t.forEach((function(t){return function(e,t){if(!1===e)throw new Error(t)}(void 0!==e[t],"Property ".concat(String(t)," is required"))})),!0};function x(e){return v(e,"PropsUIPageDataSubmission",["platform","header","body"])}function E(e){return v(e,"PropsUIPageEnd",[])}var y=function(e){return t.createElement("div",{className:"w-full h-full"},e.body)},w=function(){function e(){this.translations={},this.defaultLocale="nl"}return e.prototype.add=function(e,t){return this.translations[e]=t,this},e.prototype.translate=function(e){return d.escape(this.resolve(e))},e.prototype.resolve=function(e){var t=this.translations[e];if(null!==t)return t;var n=this.translations[this.defaultLocale];return null!==n?n:Object.values(this.translations).length>0?Object.values(this.translations)[0]:"?text?"},e}();var b={translate:function(e,t){return"string"==typeof e?e:h(e,["translations"])?function(e,t){var n=e.translations[t];if(null!==n)return n;var a=e.translations.nl;return null!==a?a:Object.values(e.translations).length>0?Object.values(e.translations)[0]:"?text?"}(e,t):void 0}},k=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"mb-6 md:mb-8 lg:mb-10":o;return t.createElement("div",{className:"text-bodylarge font-body ".concat(r," ").concat(l)},n)},C=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"":o;return t.createElement("div",{className:"text-bodysmall font-body ".concat(r," ").concat(l)},n)},D=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"mb-6 md:mb-8":o;return t.createElement("h1",{className:"text-title3 font-title3 sm:text-title2 lg:text-title1 lg:font-title1 ".concat(r," ").concat(l)},n)},N=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"mb-6 md:mb-8 lg:mb-10":o;return t.createElement("h2",{className:"text-title4 font-title4 sm:text-title3 sm:font-title3 lg:text-title2 lg:font-title2 ".concat(r," ").concat(l)},n)},_=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"mb-3 md:mb-5 lg:mb-6":o;return t.createElement("div",{className:"text-title5 font-title5 sm:text-title4 sm:font-title4 lg:text-title3 lg:font-title3 ".concat(r," ").concat(l)},n)},P=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"mb-3 md:mb-5 lg:mb-6":o;return t.createElement("div",{className:"text-title6 font-title6 sm:text-title5 sm:font-title5 lg:text-title4 lg:font-title4 ".concat(r," ").concat(l)},n)},F=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"":o;return t.createElement("div",{className:"text-label font-label ".concat(r," ").concat(l)},n)},S=function(e){var n=e.text,a=e.color,r=void 0===a?"text-grey1":a,o=e.margin,l=void 0===o?"":o;return t.createElement("div",{className:"text-caption font-caption ".concat(r," ").concat(l)},n)},R=function(e){var n=L(e),a=n.title,r=n.text,o=t.createElement(t.Fragment,null,t.createElement(D,{text:a}),t.createElement(k,{text:r}));return t.createElement(y,{body:o})};function L(e){var t=e.locale;return{title:b.translate(z,t),text:b.translate(O,t)}}var z=(new w).add("en","Thank you").add("de","Danke").add("it","Grazie").add("nl","Bedankt"),O=(new w).add("en","Thank you for your participation. You can now close the page or refresh to restart the DataSubmission flow.").add("de","Herzlichen Dank für Ihre Teilnahme. Sie können diese Seite nun schließen oder die Seite aktualisieren, um die Datenspende erneut durchzuführen.").add("it","Grazie per la tua partecipazione. Ora puoi chiudere la pagina o aggiornare per riavviare il flusso di donazione.").add("nl","Hartelijk dank voor uw deelname. U kunt deze pagina nu sluiten of de pagina verversen om de flow nogmaals te doorlopen."),j=function(){function e(){}return e.prototype.createPage=function(e,n){return E(e)?t.createElement(R,u({},e,n)):null},e}(),I=function(e){var n=e.spinning,a=void 0===n||n,r=e.color,o="dark"===(void 0===r?"light":r)?"text-gray-600":"text-white";return a?t.createElement("div",{id:"spinner",className:"flex items-center justify-center"},t.createElement("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 ".concat(o),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},t.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}))):t.createElement("div",null)};var B=function(e){var n,a=e.label,r=e.spinning,o=void 0!==r&&r,l=e.enabled,i=void 0===l||l,c=e.color,s=void 0===c?"bg-primary text-white":c,d=e.onClick;return t.createElement("div",{role:"button",className:"relative"},t.createElement("div",{className:"flex flex-col items-center leading-none font-button text-button rounded ".concat(i?"cursor-pointer active:shadow-top4px":""," ").concat(s),onClick:d},t.createElement("div",{id:"confirm-button",className:"pt-15px pb-15px pr-4 pl-4 ".concat(i?"active:pt-4 active:pb-14px":""," ").concat(o?"opacity-0":"")},a)),t.createElement("div",{className:"absolute top-0 h-full w-full flex flex-col justify-center items-center ".concat(o?"":"hidden")},t.createElement("div",{className:"w-5 h-5"},t.createElement(I,{color:(n=s,n.includes("bg-tertiary")?"dark":"light"),spinning:o}))))},U=function(e){var n=e.onClick;return t.createElement(M,{icon:"data:image/svg+xml,%3Csvg%20width%3D%228%22%20height%3D%2213%22%20viewBox%3D%220%200%208%2013%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M7.41%2011.09L2.83%206.5L7.41%201.91L6%200.5L0%206.5L6%2012.5L7.41%2011.09Z%22%20fill%3D%22%234272EF%22%2F%3E%3C%2Fsvg%3E",onClick:n})},T=function(e){var n=e.onClick;return t.createElement(M,{icon:"data:image/svg+xml,%3Csvg%20width%3D%228%22%20height%3D%2213%22%20viewBox%3D%220%200%208%2013%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M0.190186%2011.34L4.77019%206.75L0.190186%202.16L1.60019%200.75L7.60019%206.75L1.60019%2012.75L0.190186%2011.34Z%22%20fill%3D%22%234272EF%22%2F%3E%3C%2Fsvg%3E",onClick:n})},M=function(e){var n=e.icon,a=e.onClick;return t.createElement("div",{role:"button",className:"active:pt-5px active:pb-3px focus:outline-none cursor-pointer w-6 h-6",onClick:a},t.createElement("div",{className:"flex flex-col items-center h-full w-full"},t.createElement("div",{className:"flex-grow"}),t.createElement("div",null,t.createElement("img",{className:"-mt-2px",src:n})),t.createElement("div",{className:"flex-grow"})))},A=function(e){var n=e.icon,a=e.label,r=e.color,o=void 0===r?"text-grey1":r,l=e.alignment,i=void 0===l?"left":l,c=e.onClick;return t.createElement("div",{role:"button",className:"pt-1 pb-1 active:pt-5px active:pb-3px rounded bg-opacity-0 focus:outline-none cursor-pointer ",onClick:c},t.createElement("div",{className:"flex items-center"},t.createElement("div",{className:"".concat("left"===i?"":"hidden")},t.createElement("img",{className:"mr-2 -mt-2px",src:n,alt:a})),t.createElement("div",{className:"focus:outline-none"},t.createElement("div",{className:"flex flex-col justify-center h-full items-center"},t.createElement("div",{className:"flex-wrap text-button font-button ".concat(o)},a))),t.createElement("div",{className:"".concat("left"!==i?"":"hidden")},t.createElement("img",{className:"ml-2 -mt-2px",src:n,alt:a}))))},V=function(e){var n=e.label,a=e.color,r=void 0===a?"text-grey1":a,o=e.onClick;return t.createElement("div",{role:"button",className:"pt-15px pb-15px active:pt-4 active:pb-14px leading-none font-button text-button rounded pr-4 pl-4 cursor-pointer bg-opacity-0 ".concat(r),onClick:o},t.createElement("div",{id:"confirm-button",className:"flex-wrap"},n))},H=function(e){var n,a=t.useState(!1),r=a[0],o=a[1],l=t.useState(),i=l[0],c=l[1],s=t.useRef(null),d=e.resolve,u=J(e),m=u.description,f=u.note,p=u.placeholder,g=u.extensions,v=u.selectButton,h=u.continueButton;return t.createElement(t.Fragment,null,t.createElement("div",{id:"select-panel"},t.createElement("div",{className:"flex-wrap text-bodylarge font-body text-grey1 text-left"},m),t.createElement("div",{className:"mt-8"}),t.createElement("div",{className:"p-6 border-grey4 border-2 rounded"},t.createElement("input",{ref:s,id:"input",type:"file",className:"hidden",accept:g,onChange:function(e){var t=e.target.files;null!=t&&t.length>0?c(t[0]):console.log("[FileInput] Error selecting file: "+JSON.stringify(t))}}),t.createElement("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 sm:items-center"},t.createElement(k,{text:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:p,margin:"",color:void 0===i?"text-grey2":"textgrey1"}),t.createElement("div",{className:"flex-grow"}),t.createElement("div",{className:"flex-wrap"},t.createElement("div",{className:"flex flex-row"},t.createElement(B,{onClick:function(){var e;null===(e=s.current)||void 0===e||e.click()},label:v,color:"bg-tertiary text-grey1"}))))),t.createElement("div",{className:"mt-4"}),t.createElement("div",{className:"".concat(void 0===i?"opacity-30":"opacity-100")},t.createElement(C,{text:f,margin:""}),t.createElement("div",{className:"mt-8"}),t.createElement("div",{className:"flex flex-row gap-4"},t.createElement(B,{label:h,onClick:function(){void 0===i||r||(o(!0),null==d||d({__type__:"PayloadFile",value:i}))},enabled:void 0!==i,spinning:r})))))};function J(e){var t=e.description,n=e.extensions,a=e.locale;return{description:b.translate(t,a),note:b.translate(G(),a),placeholder:b.translate(K(),a),extensions:n,selectButton:b.translate(Z(),a),continueButton:b.translate(W(),a)}}var W=function(){return(new w).add("en","Continue").add("de","Weiter").add("it","Continua").add("nl","Verder")},Z=function(){return(new w).add("en","Choose file").add("de","Datei auswählen").add("it","Scegli file").add("nl","Kies bestand")},G=function(){return(new w).add("en","Note: The process to extract the correct data from the file is done on your own device. No data is stored or sent yet.").add("de","Hinweis: Der Prozess zur Extraktion der richtigen Daten aus der Datei erfolgt auf Ihrem eigenen Gerät. Es werden noch keine Daten gespeichert oder gesendet.").add("it","Nota: Il processo per estrarre i dati corretti dal file viene eseguito sul Suo dispositivo. Nessun dato viene ancora memorizzato o inviato.").add("nl","Let op: Het proces om de juiste gegevens uit het bestand te halen wordt uitgevoerd op uw eigen apparaat. Er worden nog geen gegevens opgeslagen of verzonden.")},K=function(){return(new w).add("en","E.g. data.zip").add("de","Z.B. data.zip").add("it","Esempio: data.zip").add("nl","Voorbeeld: data.zip")},Q=function(e){var n=e.percentage;return t.createElement("div",{id:"progress",className:"relative w-full overflow-hidden rounded-full"},t.createElement("div",{className:"flex flex-row items-center gap-4"},t.createElement("div",{className:"flex-grow h-4 bg-primarylight"})),t.createElement("div",{className:"absolute top-0 h-4 bg-primary",style:{width:"".concat(n,"%")}}))},q=function(e){var n=e.resolve,a=e.percentage,r=function(e){var t=e.description,n=e.message,a=e.locale;return{description:b.translate(t,a),message:n}}(e),o=r.description,l=r.message;return null==n||n({__type__:"PayloadTrue",value:!0}),t.createElement(t.Fragment,null,t.createElement("div",{className:"flex flex-col gap-8"},t.createElement("div",{className:"text-bodylarge font-body text-grey1 text-left"},o),t.createElement("div",{className:"p-6 border-grey4 border-2 rounded flex flex-col gap-4"},void 0!==a&&t.createElement(Q,{percentage:a}),t.createElement("div",{className:"flex-wrap text-bodylarge font-body text-grey2 text-left truncate"},l))))};var Y=function(e){var n=e.resolve,a=function(e){var t=e.text,n=e.ok,a=e.cancel,r=e.locale;return{text:b.translate(t,r),ok:b.translate(n,r),cancel:b.translate(a,r)}}(e),r=a.text,o=a.ok,l=a.cancel;return t.createElement(t.Fragment,null,t.createElement(k,{text:r,margin:"mb-4"}),t.createElement("div",{className:"flex flex-row gap-4"},t.createElement(B,{label:o,onClick:function(){null==n||n({__type__:"PayloadTrue",value:!0})},color:"text-grey1 bg-tertiary"}),t.createElement(B,{label:l,onClick:function(){null==n||n({__type__:"PayloadFalse",value:!1})},color:"text-white bg-primary"})))};var X=function(e){var n=e.id,a=e.value,r=e.selected,o=e.onSelect;return t.createElement("div",{id:"".concat(n),"data-testid":"radio-".concat(n),className:"radio-item flex flex-row gap-3 items-center cursor-pointer",onClick:o,role:"checkbox","aria-checked":r?"true":"false"},t.createElement("div",null,t.createElement("img",{src:"data:image/svg+xml,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%2211%22%20stroke%3D%22%23CCCCCC%22%20stroke-width%3D%222%22%2F%3E%3C%2Fsvg%3E",id:"".concat(n,"-off"),className:r?"hidden":""}),t.createElement("img",{src:"data:image/svg+xml,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%2211%22%20stroke%3D%22%234272EF%22%20stroke-width%3D%222%22%2F%3E%3Ccircle%20cx%3D%2212%22%20cy%3D%2212%22%20r%3D%226%22%20fill%3D%22%234272EF%22%2F%3E%3C%2Fsvg%3E",id:"".concat(n,"-on"),className:r?"":"hidden"})),t.createElement("div",{className:"text-grey1 text-label font-label select-none mt-1"},a))};var $=function(t){var n=e.useState(-1),a=n[0],r=n[1],o=e.useState(!1),l=o[0],i=o[1],c=e.useState(!1),s=c[0],d=c[1],u=t.items,m=t.resolve,f=function(e){var t=e.title,n=e.description,a=e.locale;return{title:b.translate(t,a),description:b.translate(n,a),continueButton:b.translate(ee(),a)}}(t),p=f.title,g=f.description,v=f.continueButton;return e.createElement(e.Fragment,null,e.createElement("div",{className:"text-title5 font-title5 sm:text-title4 sm:font-title4 lg:text-title3 lg:font-title3 text-grey1"},p),e.createElement("div",{className:"mt-8"}),e.createElement("div",{id:"select-panel"},e.createElement("div",{className:"flex-wrap text-bodylarge font-body text-grey1 text-left"},g),e.createElement("div",{className:"mt-4"}),e.createElement("div",null,e.createElement("div",{id:"radio-group",className:"flex flex-col gap-3"},function(t){return t.map((function(t,n){return e.createElement(X,{key:n,onSelect:function(){return r(n),void d(!0)},id:n,value:t.value,selected:a===n})}))}(u)))),e.createElement("div",{className:"mt-8"}),e.createElement("div",{className:"flex flex-row gap-4 ".concat(s?"":"opacity-30")},e.createElement(B,{label:v,onClick:function(){if(!l){i(!0);var e=u.at(a);void 0!==e&&(null==m||m({__type__:"PayloadString",value:e.value}))}},enabled:s,spinning:l})))},ee=function(){return(new w).add("en","Continue").add("nl","Doorgaan")},te=function(e){var n=e.id,a=e.selected,r=e.onSelect;return t.createElement("div",{id:n,className:"radio-item flex flex-row gap-3 items-center cursor-pointer",onClick:r,role:"checkbox","aria-checked":a?"true":"false"},t.createElement("div",{className:"flex-shrink-0"},t.createElement("img",{src:"data:image/svg+xml,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Crect%20x%3D%221%22%20y%3D%221%22%20width%3D%2222%22%20height%3D%2222%22%20rx%3D%223%22%20stroke%3D%22%23CCCCCC%22%20stroke-width%3D%222%22%2F%3E%3C%2Fsvg%3E",id:"".concat(n,"-off"),className:a?"hidden":""}),t.createElement("img",{src:"data:image/svg+xml,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M0%204C0%201.79086%201.79086%200%204%200H20C22.2091%200%2024%201.79086%2024%204V20C24%2022.2091%2022.2091%2024%2020%2024H4C1.79086%2024%200%2022.2091%200%2020V4Z%22%20fill%3D%22%234272EF%22%2F%3E%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22M9.59985%2018L3.59985%2012.2308L5.27985%2010.6154L9.59985%2014.7692L18.7199%206L20.3999%207.61538L9.59985%2018Z%22%20fill%3D%22white%22%2F%3E%3C%2Fsvg%3E",id:"".concat(n,"-on"),className:a?"":"hidden"})))},ne=function(e){var a=e.placeholder;e.debounce;var r=e.onSearch;function o(e){var t=e.target.value.split(/\s+/);r(t)}var l=n((function(){return d.debounce(o,300)}),[]);return t.createElement("form",null,t.createElement("div",{className:"flex flex-row"},t.createElement("input",{className:"text-grey1 text-bodymedium font-body pl-3 pr-3 w-full border-2 border-solid border-grey3 focus:outline-none focus:border-primary rounded h-48px",placeholder:a,name:"query",type:"search",onChange:l,onKeyPress:function(e){"Enter"===e.key&&e.preventDefault()}})))},ae="data:image/svg+xml,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M4%2021H14.087C17.7826%2021%2021%2018.375%2021%2014C21%209.625%2017.7826%207%2014.087%207H7.69565%22%20stroke%3D%22%234272EF%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%2F%3E%3Cpath%20d%3D%22M10%203L6%207L10%2011%22%20stroke%3D%22%234272EF%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%2F%3E%3C%2Fsvg%3E",re="data:image/svg+xml,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M5.5%207L6.5%2021H17.5L18.5%207%22%20stroke%3D%22%23DB1E1E%22%20stroke-width%3D%222%22%2F%3E%3Cmask%20id%3D%22path-2-inside-1_1050_57%22%20fill%3D%22white%22%3E%3Crect%20x%3D%222%22%20y%3D%223%22%20width%3D%2220%22%20height%3D%225%22%20rx%3D%221%22%2F%3E%3C%2Fmask%3E%3Crect%20x%3D%222%22%20y%3D%223%22%20width%3D%2220%22%20height%3D%225%22%20rx%3D%221%22%20stroke%3D%22%23DB1E1E%22%20stroke-width%3D%224%22%20mask%3D%22url%28%23path-2-inside-1_1050_57%29%22%2F%3E%3Cmask%20id%3D%22path-3-inside-2_1050_57%22%20fill%3D%22white%22%3E%3Cpath%20d%3D%22M9%202C9%201.44772%209.44772%201%2010%201H14C14.5523%201%2015%201.44772%2015%202V4H9V2Z%22%2F%3E%3C%2Fmask%3E%3Cpath%20d%3D%22M9%202C9%201.44772%209.44772%201%2010%201H14C14.5523%201%2015%201.44772%2015%202V4H9V2Z%22%20stroke%3D%22%23DB1E1E%22%20stroke-width%3D%223%22%20stroke-linejoin%3D%22round%22%20mask%3D%22url%28%23path-3-inside-2_1050_57%29%22%2F%3E%3C%2Fsvg%3E",oe=function(e){var n=e.index,a=e.selected,r=e.onClick;return t.createElement("div",{className:"rounded ".concat(n>999?"w-10":n>99?"w-9":"w-8"," h-8 cursor-pointer flex-shrink-0 overflow-hidden ").concat(a?"bg-primary":"bg-grey5 "),onClick:r},t.createElement("div",{className:"flex flex-row items-center justify-center w-full h-full"},t.createElement("div",{className:"text-label font-label ".concat(a?"text-white":"text-grey2")},"".concat(n))))},le=function(e){var n=e.pageCount,a=e.page,r=e.pageWindowLegSize,o=e.onChange,l=function(e,t){var n=2*r+1,a=[];if(n>=e&&e>0)a=d.range(0,Math.min(e,n));else if(n<e){var o=e-1,l=void 0,i=void 0;t<r?(l=0,i=Math.min(e,n)):o-t<=r?(l=o-(n-1),i=o+1):(l=t-r,i=t+r+1),a=d.range(l,i)}return a}(n,a);function i(e){return t.createElement(oe,{key:"page-".concat(e),index:e+1,selected:a===e,onClick:function(){return function(e){o(e)}(e)}})}return t.createElement("div",{className:"flex flex-row items-center gap-2 mt-2"},t.createElement("div",{className:"flex-grow"}),t.createElement(U,{onClick:function(){o(0===a?n-1:a-1)}}),t.createElement("div",null,t.createElement("div",{className:"flex flex-row gap-2"},l.map((function(e){return i(e)})))),t.createElement(T,{onClick:function(){o(a===n-1?0:a+1)}}),t.createElement("div",{className:"flex-grow"}))},ie=function(e){var n,a,r=e.head,o=e.rows,l=e.id,i=e.edit,c=e.selected,s=e.locale,d=e.onChange,u=function(e){return{link:b.translate(ce,e)}}(s);return t.createElement("table",{"data-testid":"table-".concat(l),className:"text-grey1 table-fixed divide-y divide-grey4"},t.createElement("thead",null,(n=r,t.createElement("tr",null,i?(a=c.length>0&&c.length===o.length,t.createElement("td",{key:"check-head",className:"pl-4 w-10"},t.createElement(te,{id:"-1",selected:a,onSelect:function(){var e;c.length===o.length?d([]):(e=o.map((function(e){return e.id})),d(e))}}))):"",n.cells.map((function(e,n){return function(e,n){return t.createElement("th",{key:"".concat(n),className:"h-12 px-4 text-left"},t.createElement("div",{className:"font-table-header text-table text-grey1"},e.text))}(e,n)}))))),t.createElement("tbody",{className:"divide-y divide-grey4"},o.map((function(e,n){return function(e,n){return t.createElement("tr",{key:"".concat(n),className:"hover:bg-grey6"},i?(a=e.id,r=c.includes(a),t.createElement("td",{key:"check-".concat(a),className:"pl-4"},t.createElement(te,{id:a,selected:r,onSelect:function(){return function(e){var t=c.slice(0),n=t.indexOf(e);-1===n?t.push(e):t.splice(n,1),d(t)}(a)}}))):"",e.cells.map((function(e,n){return function(e,n){var a,r=e.text,o=function(e){var t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}(r)?(a=r,t.createElement("div",{className:"font-table-row text-table text-primary underline"},t.createElement("a",{href:a,target:"_blank",rel:"noreferrer",title:a},u.link))):function(e){return t.createElement("div",{className:"font-table-row text-table text-grey1"},e)}(r);return t.createElement("td",{key:"".concat(n),className:"h-12 px-4"},o)}(e,n)})));var a,r}(e,n)}))))},ce=(new w).add("en","Visit URL").add("de","URL besuchen").add("it","Visita URL").add("nl","Bezoek URL"),se=function(e){var n,a=e.title,r=e.description,o=function(e){return{link:b.translate(de,e)}}(e.locale),l=function(e){var t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}(r.text)?(n=r.text,t.createElement("div",{className:"font-table-row text-table text-primary underline"},t.createElement("a",{href:n,target:"_blank",rel:"noreferrer",title:n},o.link))):function(e){return t.createElement("div",{className:"font-table-row text-table text-grey1"},e)}(r.text);return t.createElement("div",{className:"w-full flex flex-col items-left gap-2"},t.createElement("div",{className:"font-card text-left text-card-key"},a.text),t.createElement("div",{className:"font-card text-left text-card-value"},l))},de=(new w).add("en","Visit URL").add("de","URL besuchen").add("it","Visita URL").add("nl","Bezoek URL"),ue=function(e){var n=e.row,a=e.headCells,r=e.locale,o=e.onDelete,l=a.map((function(e,t){return[e,n.cells[t]]}));return t.createElement("div",{className:"flex flex-row w-full p-4 border border-grey4 bg-white rounded-lg shadow-[0px_5px_20px_0px_rgba(0,0,0,0.10)] "},t.createElement("div",{className:"w-full flex flex-col items-left gap-4"},l.map((function(e,n){var a=e[0],o=e[1];return t.createElement(se,{title:a,description:o,locale:r,key:"".concat(n)})}))),t.createElement("div",{className:"flex-grow"}),t.createElement("div",{className:"flex-shrink-0"},t.createElement(M,{icon:re,onClick:function(){return o(n.id)}})))},me=function(e){var n=e.head,a=e.rows,r=e.locale,o=e.onDelete;return t.createElement("div",{className:"flex flex-col gap-4 px-4"},a.map((function(e,a){return t.createElement(ue,{row:e,headCells:n.cells,locale:r,onDelete:o,key:"".concat(a)})})))},fe=function(e){var n=e.id,a=e.head,r=e.body;e.readOnly;var o=e.locale,l=e.onChange,i=t.useRef([]),c=t.useRef(r.rows),s=t.useRef(c.current),d={edit:!1,desktopPage:0,desktopPageCount:h(7),desktopRows:x(0,7),mobilePage:0,mobilePageCount:h(1),mobileRows:x(0,1),selected:[],deletedCount:0,visibility:{delete:!1,undo:!1,table:s.current.length>0,noData:0===s.current.length,noDataLeft:!1,noResults:!1}},m=t.useState(d),f=m[0],p=m[1],g=function(e){return{edit:b.translate(xe,e),undo:b.translate(Ee,e),noData:b.translate(ge,e),noDataLeft:b.translate(ve,e),noResults:b.translate(he,e),desktopPages:b.translate(be(f.desktopPageCount),e),mobilePages:b.translate(be(f.mobilePageCount),e),delete:b.translate(ye,e),deleted:b.translate(we(r.rows.length-c.current.length),e),searchPlaceholder:b.translate(pe,e)}}(o);function v(e){return function(e){if("boolean"==typeof f.visibility[e])return f.visibility[e];return!1}(e)?"":"hidden"}function h(e){return 0===s.current.length?0:Math.ceil(s.current.length/e)}function x(e,t){var n=e*t;return s.current.slice(n,n+t)}function E(){return 0===i.current.length?c.current:c.current.filter((function(e){return function(e,t){var n=e.cells.map((function(e){return e.text})).join(" ");return void 0===t.find((function(e){return!n.includes(e)}))}(e,i.current)}))}function y(e){for(var t=c.current.slice(0),n=function(e){var n=t.findIndex((function(t){return t.id===e}));-1!==n&&t.splice(n,1)},a=0,o=e;a<o.length;a++){n(o[a])}c.current=t,s.current=E(),p((function(e){var t=h(7),n=Math.max(0,Math.min(t-1,e.desktopPage)),a=x(n,7),o=h(1),l=Math.max(0,Math.min(o-1,e.mobilePage)),i=x(l,1),d=r.rows.length-c.current.length,m=u(u({},e.visibility),{undo:d>0,table:s.current.length>0,noData:!1,noDataLeft:0===c.current.length,noResults:c.current.length>0&&0===s.current.length});return u(u({},e),{desktopPage:n,desktopPageCount:t,desktopRows:a,mobilePage:l,mobilePageCount:o,mobileRows:i,deletedCount:d,selected:[],visibility:m})})),l(c.current,f.deletedCount)}function w(){c.current=r.rows,s.current=E(),p((function(e){var t=h(7),n=Math.min(t,e.desktopPage),a=x(n,7),r=h(1),o=Math.min(r,e.mobilePage),l=x(o,1),i=u(u({},e.visibility),{undo:!1,table:s.current.length>0,noData:!1,noDataLeft:!1,noResults:0===s.current.length});return u(u({},e),{desktopPage:n,desktopPageCount:t,desktopRows:a,mobilePage:o,mobilePageCount:r,mobileRows:l,deletedCount:0,selected:[],visibility:i})})),l(r.rows,0)}function k(e){i.current=e,s.current=E(),p((function(e){var t=h(7),n=Math.min(t,e.desktopPage),a=x(n,7),o=h(1),l=Math.min(o,e.mobilePage),i=x(l,1),d=u(u({},e.visibility),{table:s.current.length>0,noData:0===r.rows.length,noDataLeft:r.rows.length>0&&0===c.current.length,noResults:r.rows.length>0&&c.current.length>0&&0===s.current.length});return u(u({},e),{desktopPage:n,desktopPageCount:t,desktopRows:a,mobilePage:l,mobilePageCount:o,mobileRows:i,visibility:d})}))}return t.createElement(t.Fragment,null,t.createElement("div",{className:"flex flex-col gap-4"},t.createElement("div",{className:"hidden sm:block"},t.createElement("div",{className:"flex flex-row gap-4 items-center"},t.createElement("div",{className:"".concat(r.rows.length<=7?"hidden":""," ")},t.createElement(le,{pageCount:f.desktopPageCount,page:f.desktopPage,pageWindowLegSize:3,onChange:function(e){p((function(t){var n=x(e,7);return u(u({},t),{desktopPage:e,desktopRows:n})}))}})),t.createElement("div",{className:"flex-grow"}),t.createElement(S,{text:g.desktopPages,color:"text-grey2",margin:""}),t.createElement("div",null,t.createElement(ne,{placeholder:g.searchPlaceholder,onSearch:function(e){return k(e)}})))),t.createElement("div",{className:"block sm:hidden"},t.createElement("div",{className:"flex flex-row gap-4"},t.createElement("div",{className:"w-full"},t.createElement(ne,{placeholder:g.searchPlaceholder,onSearch:function(e){return k(e)}})))),f.desktopRows.length>0&&t.createElement("div",{className:"hidden sm:block"},t.createElement("div",{className:"flex flex-col ".concat(v("table"))},t.createElement(ie,{head:a,rows:f.desktopRows,id:n,edit:f.edit,selected:f.selected,locale:o,onChange:function(e){p((function(t){return u(u({},t),{selected:e})}))}}))),f.mobileRows.length>0&&t.createElement("div",{className:"block sm:hidden"},t.createElement(me,{head:a,rows:f.mobileRows,locale:o,onDelete:function(e){y([e])},key:n})),t.createElement("div",{className:"flex flex-col justify-center items-center w-full h-[200px] sm:h-table bg-grey6 ".concat(v("noData"))},t.createElement(_,{text:g.noData,color:"text-grey3",margin:""})),t.createElement("div",{className:"flex flex-col justify-center items-center w-full h-[200px] sm:h-table bg-grey6 ".concat(v("noDataLeft"))},t.createElement(_,{text:g.noDataLeft,color:"text-grey3",margin:""})),t.createElement("div",{className:"flex flex-col justify-center items-center w-full h-[200px] sm:h-table bg-grey6 ".concat(v("noResults"))},t.createElement(_,{text:g.noResults,color:"text-grey3",margin:""})),t.createElement("div",{className:"hidden sm:block"},t.createElement("div",{className:"flex flex-row items-center gap-6 mt-2 h-8 ".concat(0===r.rows.length?"hidden":""," ")},t.createElement("div",{className:"flex flex-row gap-4 items-center"},t.createElement(te,{id:"edit",selected:f.edit,onSelect:function(){p((function(e){var t=!e.edit,n=u(u({},e.visibility),{delete:t});return u(u({},e),{edit:t,visibility:n})}))}}),t.createElement(F,{text:g.edit,margin:"mt-1px"})),t.createElement("div",{className:"".concat(v("delete")," mt-1px")},t.createElement(A,{label:g.delete,color:"text-delete",icon:re,onClick:function(){var e=f.selected.slice(0);0!==e.length&&y(e)}})),t.createElement("div",{className:"flex-grow"}),t.createElement(F,{text:g.deleted}),t.createElement("div",{className:"".concat(v("undo"))},t.createElement(A,{label:g.undo,color:"text-primary",icon:ae,onClick:w})))),t.createElement("div",{className:"block sm:hidden"},t.createElement("div",{className:"flex flex-col gap-4"},f.deletedCount>0&&t.createElement("div",{className:"flex flex-row gap-4 items-center"},t.createElement(F,{text:g.deleted}),t.createElement("div",{className:"flex-grow"}),t.createElement("div",{className:"".concat(v("undo"))},t.createElement(A,{label:g.undo,color:"text-primary",icon:ae,onClick:w}))),t.createElement("div",{className:"flex flex-col gap-4 items-center"},t.createElement("div",{className:"".concat(r.rows.length<=1?"hidden":""," ")},t.createElement(le,{pageCount:f.mobilePageCount,page:f.mobilePage,pageWindowLegSize:2,onChange:function(e){p((function(t){var n=x(e,1);return u(u({},t),{mobilePage:e,mobileRows:n})}))}})),t.createElement(S,{text:g.mobilePages,color:"text-grey2",margin:""}))))))},pe=(new w).add("en","Search").add("de","Suchen").add("it","Cerca").add("nl","Zoeken"),ge=(new w).add("en","No data found").add("de","Keine Daten gefunden").add("it","Nessun dato trovato").add("nl","Geen gegevens gevonden"),ve=(new w).add("en","All data removed").add("de","Alle Daten gelöscht").add("it","Tutti i dati rimossi").add("nl","Alle gegevens verwijderd"),he=(new w).add("en","No search results").add("de","Keine Suchergebnisse").add("it","Nessun risultato di ricerca").add("nl","Geen zoek resultaten"),xe=(new w).add("en","Adjust").add("de","Anpassen").add("it","Regola").add("nl","Aanpassen"),Ee=(new w).add("en","Undo").add("de","Rückgängig machen").add("it","Annulla").add("nl","Ongedaan maken"),ye=(new w).add("en","Delete selected").add("de","Auswahl löschen").add("it","Elimina selezione").add("nl","Verwijder selectie");function we(e){return 0===e?(new w).add("en","No adjustments").add("de","Keine Anpassungen").add("it","Nessuna modifica").add("nl","Geen aanpassingen"):1===e?function(e){return(new w).add("en","".concat(e," row deleted")).add("de","".concat(e," Zeile gelöscht")).add("it","".concat(e," Riga eliminata")).add("nl","".concat(e," rij verwijderd"))}(e):function(e){return(new w).add("en","".concat(e," rows deleted")).add("de","".concat(e," Zeilen gelöscht")).add("it","".concat(e," Righe eliminate")).add("nl","".concat(e," rijen verwijderd"))}(e)}function be(e){return 1===e?(new w).add("en","1 page").add("de","1 Seite").add("it","1 pagina").add("nl","1 pagina"):function(e){return(new w).add("en","".concat(e," pages")).add("de","".concat(e," Seiten")).add("it","".concat(e," pagine")).add("nl","".concat(e," pagina's"))}(e)}var ke=function(e){var n=e.number;return t.createElement("div",{className:"flex-shrink-0 icon w-6 h-6 font-caption text-caption text-white bg-primary rounded-full flex items-center ".concat(function(e){switch(e){case 1:case 4:return"mr-1px";default:return""}}(n))},t.createElement("span",{className:"text-center w-full mt-1px"},n))},Ce=a((function(e,n){var a=e.table,r=e.readOnly,o=void 0!==r&&r,l=e.context;e.onChange;var i=t.useState(a),c=i[0];i[1];return t.useEffect((function(){console.log("ConsentTable useEffect",c),l.onDataSubmissionDataChanged(a.id,De(a.head,a.body.rows,0))}),[]),t.createElement("div",{key:a.id,className:"flex flex-col gap-4 mb-20"},t.createElement("div",{className:"flex flex-row gap-4 items-center"},t.createElement(ke,{number:a.number}),t.createElement("div",{className:"pt-2px"},t.createElement(P,{text:a.title,margin:""}))),t.createElement(fe,u({},a,{readOnly:o,locale:l.locale,onChange:function(e,t){l.onDataSubmissionDataChanged(a.id,De(a.head,e,t))},id:a.id,key:a.id})))}));function De(e,t,n){return{data:Ne(e,t),metadata:{deletedRowCount:n}}}function Ne(e,t){return t.map((function(t){return function(e,t){var n=t.cells.map((function(e){return e.text})),a=e.cells.map((function(e){return e.text}));return d.fromPairs(d.zip(n,a))}(t,e)}))}Ce.displayName="ConsentTable";var _e=function(e){var n=e.onDonate,a=e.onCancel,l=e.locale,i=e.donateQuestion,c=e.donateButton,s=r(!1),d=s[0],u=s[1],m=o((function(){u(!0),n()}),[n,u]);return t.createElement("div",null,t.createElement(k,{margin:"",text:b.translate(null!=i?i:Pe,l)}),t.createElement("div",{className:"flex flex-row gap-4 mt-4 mb-4"},t.createElement(B,{label:b.translate(null!=c?c:Fe,l),onClick:m,color:"bg-success text-white",spinning:d}),t.createElement(V,{label:b.translate(Se,l),onClick:a,color:"text-grey1"})))},Pe=(new w).add("en","Do you want to donate the above data?").add("nl","Wilt u de bovenstaande gegevens doneren?"),Fe=(new w).add("en","Yes, donate").add("nl","Ja, doneer"),Se=(new w).add("en","No").add("nl","Nee"),Re=function(t){var n=function(e){var t=e.text,n=e.title,a=e.locale;return{text:b.translate(t,a),title:n?b.translate(n,a):void 0}}(t),a=n.text,r=n.title;return e.createElement(e.Fragment,null,e.createElement("div",{className:"my-8"},r&&e.createElement(e.Fragment,null,e.createElement(_,{text:r,margin:"mb-4"})),e.createElement(k,{text:a,margin:""})))};var Le=function(){function e(){}return e.prototype.create=function(e,n){return v(e,"PropsUIPromptFileInput",["description","extensions"])?t.createElement(H,u(u({},e),n)):null},e}(),ze=function(){function e(){}return e.prototype.create=function(e,n){return v(e,"PropsUIPromptProgress",["description","message"])?t.createElement(q,u(u({},e),n)):null},e}(),Oe=function(){function e(){}return e.prototype.create=function(e,n){return v(e,"PropsUIPromptConfirm",["text","ok","cancel"])?t.createElement(Y,u(u({},e),n)):null},e}(),je=function(){function e(){}return e.prototype.create=function(e,n){return v(e,"PropsUIPromptRadioInput",["title","description","items"])?t.createElement($,u(u({},e),n)):null},e}(),Ie=function(){function e(){}return e.prototype.create=function(e,n){if(v(e,"PropsUIPromptConsentFormTable",["id","number","title","description","data_frame"])){var a=e.id,r=e.number,o=e.title,l=e.description,i=e.data_frame,c=JSON.parse(i),s=e.headers||{},d={__type__:"PropsUITable",id:a,head:{__type__:"PropsUITableHead",cells:Object.keys(c).map((function(e){return{__type__:"PropsUITableCell",text:s[e]?b.translate(s[e],n.locale):e}}))},body:{__type__:"PropsUITableBody",rows:Object.keys(c[Object.keys(c)[0]]||{}).map((function(e){return{__type__:"PropsUITableRow",id:e,cells:Object.keys(c).map((function(t){return{__type__:"PropsUITableCell",text:String(c[t][e])}}))}}))}};return t.createElement(Ce,{table:u(u({},d),{number:r,title:b.translate(o,n.locale),description:l&&b.translate(l,n.locale),deletedRowCount:0}),context:n,onChange:function(){}})}return null},e}(),Be=function(){function e(){}return e.prototype.create=function(e,n){if(v(e,"PropsUIDataSubmissionButtons",["donateQuestion","donateButton"])){var a=e.donateQuestion,r=e.donateButton,o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n}(e,["donateQuestion","donateButton"]),l=u(u(u({},o),n),{donateQuestion:a,donateButton:r});return t.createElement(_e,l)}return null},e}(),Ue=function(){function e(){}return e.prototype.create=function(e,n){return v(e,"PropsUIPromptText",["text"])?t.createElement(Re,u(u({},e),n)):null},e}(),Te=function(e){var n,a=function(e){var t=e.header.title,n=e.locale;return{title:b.translate(t,n)}}(e).title,r=e.locale,l=(void 0===(n=e.promptFactories)&&(n=[]),p(p([],n,!0),[new Le,new ze,new Oe,new je,new Ie,new Be,new Ue],!1)),i=t.useRef(new Map),c=o((function(e,t){console.log("onDataSubmissionDataChanged",e,t),i.current.set(e,t)}),[i]);function s(){var t,n=Object.fromEntries(i.current);console.log("onDonate",JSON.stringify(n)),null===(t=e.resolve)||void 0===t||t.call(e,{__type__:"PayloadJSON",value:JSON.stringify(n)})}var d=t.createElement(t.Fragment,null,t.createElement(D,{text:a}),function(e){var n={locale:r,resolve:e.resolve,onDataSubmissionDataChanged:c,onDonate:s};return(Array.isArray(e.body)?e.body:[e.body]).map((function(e,a){var r=function(e,t){for(var n=0,a=l;n<a.length;n++){var r=a[n].create(e,t);if(null!==r)return r}return null}(e,n);if(null===r)throw new TypeError("No factory found for body item at index ".concat(a));return t.createElement(t.Fragment,{key:a},r)}))}(e));return t.createElement(y,{body:d})};var Me=function(){function e(e){var t=(void 0===e?{}:e).promptFactories,n=void 0===t?[]:t;this.promptFactories=n}return e.prototype.createPage=function(e,n){return x(e)?t.createElement(Te,u({},e,n,{promptFactories:this.promptFactories})):null},e}(),Ae=function(){function e(e){void 0===e&&(e=[]),this.factories=p(p([],e,!0),[new j,new Me],!1)}return e.prototype.createPage=function(e,t){for(var n=0,a=this.factories;n<a.length;n++){var r=a[n].createPage(e,t);if(null!==r)return r}throw TypeError("Unknown page: "+JSON.stringify(e))},e.prototype.registerFactory=function(e){this.factories.push(e)},e}();function Ve(e){return We(e)||function(e){return v(e,"CommandSystemEvent",["name"])}(e)||He(e)}function He(e){return v(e,"CommandSystemExit",["code","info"])}function Je(e){return function(e){return v(e,"CommandUIRender",["page"])&&function(e){return x(e)||E(e)}(e.page)}(e)}function We(e){return v(e,"CommandSystemDonate",["key","json_string"])}var Ze=function(){function e(e,t){this.bridge=e,this.visualizationEngine=t}return e.prototype.onCommand=function(e){return m(this,void 0,void 0,(function(){var t=this;return f(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,a){Ve(e)?t.onCommandSystem(e,n):Je(e)?t.onCommandUI(e,n):a(new TypeError("[CommandRouter] Unknown command"+JSON.stringify(e)))}))];case 1:return[2,n.sent()]}}))}))},e.prototype.onCommandSystem=function(e,t){this.bridge.send(e),He(e)?console.log("[CommandRouter] Application exit"):t({__type__:"Response",command:e,payload:{__type__:"PayloadVoid",value:void 0}})},e.prototype.onCommandUI=function(e,t){this.visualizationEngine.render(e).then((function(n){n&&n.__type__?t(n):(console.error("[CommandRouter] Invalid response:",n),t({__type__:"Response",command:e,payload:{__type__:"PayloadVoid",value:void 0}}))})).catch((function(n){console.error("[CommandRouter] Error:",n),t({__type__:"Response",command:e,payload:{__type__:"PayloadVoid",value:void 0}})}))},e}(),Ge=function(){function e(e,t,n){var a=this;this.sessionId=e,this.commandHandler=n,this.worker=t,this.worker.onerror=console.log,this.worker.onmessage=function(e){console.log("[WorkerProcessingEngine] Received event from worker: ",e.data.eventType),a.handleEvent(e)}}return e.prototype.sendSystemEvent=function(e){var t={__type__:"CommandSystemEvent",name:e};this.commandHandler.onCommand(t).then((function(){}),(function(){}))},e.prototype.handleEvent=function(e){var t=e.data.eventType;switch(console.log("[ReactEngine] received eventType: ",t),t){case"initialiseDone":console.log("[ReactEngine] received: initialiseDone"),this.resolveInitialized();break;case"runCycleDone":console.log("[ReactEngine] received: event",e.data.scriptEvent),this.handleRunCycle(e.data.scriptEvent);break;default:console.log("[ReactEngine] received unsupported flow event: ",t)}},e.prototype.start=function(){var e=this;console.log("[WorkerProcessingEngine] started"),this.waitForInitialization().then((function(){e.sendSystemEvent("initialized"),e.firstRunCycle()}),(function(){}))},e.prototype.waitForInitialization=function(){return m(this,void 0,void 0,(function(){var e=this;return f(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){e.resolveInitialized=t,console.debug("[WorkerProcessingEngine] waiting for initialisation"),e.worker.postMessage({eventType:"initialise"})}))];case 1:return[2,t.sent()]}}))}))},e.prototype.firstRunCycle=function(){this.worker.postMessage({eventType:"firstRunCycle",sessionId:this.sessionId})},e.prototype.nextRunCycle=function(e){console.log("[WorkerProcessingEngine] nextRunCycle"),this.worker.postMessage({eventType:"nextRunCycle",response:e})},e.prototype.terminate=function(){this.worker.terminate()},e.prototype.handleRunCycle=function(e){var t,n=this;(Je(t=e)||Ve(t))&&this.commandHandler.onCommand(e).then((function(e){return n.nextRunCycle(e)}),(function(){}))},e}(),Ke=function(e,t,n){void 0===n&&(n=[]);var a=String(Date.now()),r=new Ae(n);this.visualizationEngine=new g(r),this.router=new Ze(t,this.visualizationEngine),this.processingEngine=new Ge(a,e,this.router)},Qe=function(){function e(e){this.port=e}return e.create=function(t,n){t.addEventListener("message",(function(t){if(console.log("MESSAGE RECEIVED",t),"live-init"===t.data.action&&!e.initialized){e.initialized=!0;var a=new e(t.ports[0]),r=t.data.locale;console.log("LOCALE",r),n(a,r)}}))},e.prototype.send=function(e){Ve(e)?(this.log("info","send",e),this.port.postMessage(e)):this.log("error","received unknown command",e)},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];("info"===e?console.log:console.error).apply(void 0,p(["[LiveBridge]"],t,!1))},e.initialized=!1,e}(),qe=function(){function e(){}return e.prototype.send=function(e){We(e)?this.handleDataSubmission(e):He(e)?this.handleExit(e):console.log("[FakeBridge] received unknown command: "+JSON.stringify(e))},e.prototype.handleDataSubmission=function(e){return m(this,void 0,void 0,(function(){var t,n;return f(this,(function(a){switch(a.label){case 0:console.log("[FakeBridge] received dataSubmission: ".concat(e.key,"=").concat(e.json_string)),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch("/data-submission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e.key,data:e.json_string})})];case 2:return(t=a.sent()).ok?console.log("[FakeBridge] Data submission succeeded with status: ".concat(t.status)):console.error("[FakeBridge] Data submission failed with status: ".concat(t.status)),[3,4];case 3:return n=a.sent(),console.error("[FakeBridge] Error during data submission:",n),[3,4];case 4:return[2]}}))}))},e.prototype.handleExit=function(e){console.log("[FakeBridge] received exit: ".concat(e.code,"=").concat(e.info))},e}(),Ye=l(void 0),Xe=function(e){var n=e.children,a=r({elements:[]}),o=a[0],l=a[1];return t.createElement(Ye.Provider,{value:{state:o,setState:l}},n)},$e=function(e){var n=e.workerUrl,a=e.locale,r=void 0===a?"nl":a,o=e.standalone,l=void 0!==o&&o,d=e.className,u=e.factories,m=void 0===u?[]:u,f=c(null),p=c(null),g=c(null),v=function(){var e=i(Ye);if(!e)throw new Error("useVisualization must be used within a VisualizationProvider");return e}(),h=v.setState,x=v.state;return s((function(){if(f.current){var e=new Worker(n);g.current=e;var t=function(t,n){void 0===n&&(n=r);var a=new Ke(e,t,m);a.visualizationEngine.start(f.current,n,h),a.processingEngine.start(),p.current=a};l||"production"!==process.env.NODE_ENV?(console.log("Running with fake bridge"),t(new qe)):(console.log("Initializing bridge system"),Qe.create(window,t));var a=new ResizeObserver((function(){var e=window.document.documentElement.getBoundingClientRect().height;window.parent.postMessage({action:"resize",height:e},"*")}));return a.observe(window.document.body),window.parent.postMessage({action:"app-loaded"},"*"),function(){a.disconnect(),setTimeout((function(){var e,t;null===(e=p.current)||void 0===e||e.visualizationEngine.terminate(),null===(t=p.current)||void 0===t||t.processingEngine.terminate(),g.current&&(g.current.terminate(),g.current=null)}),0)}}}),[n,r,l,h,m]),t.createElement("div",{ref:f,className:d},x.elements)},et=function(e){return t.createElement(Xe,null,t.createElement($e,u({},e)))};export{k as BodyLarge,C as BodySmall,Me as DataSubmissionPageFactory,qe as FakeBridge,V as LabelButton,Qe as LiveBridge,B as PrimaryButton,et as ScriptHostComponent,D as Title1,N as Title2,_ as Title3,P as Title4,b as Translator,w as default,v as isInstanceOf};
//# sourceMappingURL=index.esm.js.map
